#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2025, Manchester (http://www.manchester.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#zrq-notes-indent
#
# AIMetrics: []
#

    Target:

        Success

    Result:

        Work in progress ...

# -----------------------------------------------------

    Thoughts on a new structure for the schema.
    Now that we have the OpenAPI pre-processor, we can move things into separate files and directories.

    One step to check, does the pre-processor follow $ref links in the service part of the specification ?

    Assuming that works, or can be fixed, we move everything into separate files.

# -----------------------------------------------------

    EditorRequest
    EditorResponse

    UpdateRequest
    UpdateResponse

    OffersRequest
    OffersResponse

    SessionRequest
    SessionResponse


# -----------------------------------------------------

    /requests
        GET 200 => List<EditingResponse> owned by this user
            x00 => ErrorRespose

        GET ?phase=<phase>
            200 => List<EditingResponse> with phase = <phase>, owned by this user
            x00 => ErrorRespose

        PUT  EditingRequest
        POST EditingRequest
            200 => EditingResponse + 300 redirect to /requests/{uuid}
            x00 => ErrorRespose

    /requests/{uuid}
        GET 200 => EditingResponse
            x00 => ErrorRespose

    /requests/{uuid}/update
        POST UpdateRequest
            200 => UpdateRespose + 300 redirect to /requests/{uuid}
            x00 => ErrorRespose

        Setting phase = SUBMITTED is equivalent to POST to /offers
        with redirect to /offers/{uuid}


    /offers
        GET 200 => List<OfferSetResponse> owned by this user
            x00 => ErrorRespose

        GET ?phase=<phase>
            200 => List<OfferSetResponse> with phase = <phase>, owned by this user
            x00 => ErrorRespose

        PUT  OfferSetRequest
        POST OfferSetRequest
            200 => OfferSetResponse + 300 redirect to /offers/{uuid}
            x00 => ErrorRespose

    /offers/{uuid}
        GET 200 => OfferSetResponse
            x00 => ErrorRespose

    /offers/{uuid}/update
        POST UpdateRequest
            200 => UpdateRespose + 300 redirect to /offers/{uuid}
            x00 => ErrorRespose

    /sessions
        GET 200 => List<SessionResponse> owned by this user
            x00 => ErrorRespose

        GET ?phase=<phase>
            200 => List<SessionResponse> with phase = <phase>, owned by this user
            x00 => ErrorRespose

    /sessions/{uuid}
        GET 200 => SessionResponse
            x00 => ErrorRespose

    /sessions/{uuid}/update
        POST UpdateRequest
            200 => UpdateRespose + 300 redirect to /sessions/{uuid}
            x00 => ErrorRespose

    /sessions/{uuid}/excutable
        GET 200 => AbstractExecutable
            x00 => ErrorRespose

        PUT  AbstractExecutable
        POST AbstractExecutable
            200 => AbstractExecutable + 300 redirect to /sessions/{uuid}/excutable/{uuid}
            x00 => ErrorRespose

    /sessions/{uuid}/excutable/{uuid}
        GET 200 => AbstractExecutable
            x00 => ErrorRespose

    /sessions/{uuid}/excutable/{uuid}/update
        POST UpdateRequest
            200 => UpdateRespose + 300 redirect to /sessions/{uuid}/excutable/{uuid}
            x00 => ErrorRespose


    /sessions/{uuid}/compute
        Same as executable


    /sessions/{uuid}/data
        GET 200 => List<AbstractDataResourceResponse>
            x00 => ErrorRespose

        GET ?phase=<phase>
            200 => List<AbstractDataResourceResponse> with phase = <phase>
            x00 => ErrorRespose

        PUT  AbstractDataResourceRequest
        POST AbstractDataResourceRequest
            200 => AbstractDataResourceResponse + 300 redirect to /sessions/{uuid}/data/{uuid}
            x00 => ErrorRespose

    /sessions/{uuid}/data/{uuid}
        GET 200 => AbstractDataResourceResponse
            x00 => ErrorRespose

    /sessions/{uuid}/data/{uuid}/update
        POST UpdateRequest
            200 => AbstractDataResourceResponse + 300 redirect to /sessions/{uuid}/data/{uuid}
            x00 => ErrorRespose

    /sessions/{uuid}/storage
        Same as data

    /sessions/{uuid}/vlume
        Same as data


# -----------------------------------------------------


    BaseComponent
        uuid
        name
        description

    AbstractComponent
        type

    RequestComponent

    ResponseComponent
        BaseComponent
        phase:  ComponentLifecyclePhase
        owner:    string
        created:  datetime
        modified: datetime
        expires:  datetime

    ComponentLifecyclePhase
        EDITING
        SUBMITTED

        ACCEPTED
        REJECTED
        EXPIRED

        PREPARING
        ACTIVE
        RELEASING

        COMPLETED
        CANCELLED
        FAILED

    UpdateRequest
        ....

    ErrorResponse
        ....

    SessionScheduleRequest
        start: array interval
        duration: duration

    SessionScheduleResponse
        preparing: interval
        available: interval
        releasing: interval

    ResourceScheduleRequest
        before: duration
        after:  duration

    ResourceScheduleResponse
        preparing: interval
        available: interval
        releasing: interval

    SessionEditingRequest
        RequestComponent
        SessionRequest

    SessionEditingResponse
        ResponseComponent
        SessionRequest

    SessionRequest
        BaseComponent
        AbstractComponent
        RequestComponent
        schedule: ScheduleRequest
        executable: ExecutableRequest
        compute: ComputeResourceRequest
        data: List<DataResourceRequest>
        storage: List<StorageResourceRequest>
        volumes: List<VolumeMountRequest>

    SessionResponse
        BaseComponent
        AbstractComponent
        ResponseComponent
        schedule: ScheduleResponse
        excutable: ExecutableResponse
        computer: ComputeResourceResponse
        data: List<DataResourceResponse>
        storage: List<StorageResourceResponse>
        volumes: List<VolumeMountResponse>

    OfferSetRequest
        SessionRequest

    OfferSetResponse
        BaseComponent
        AbstractComponent
        ResponseComponent
        offers: List<SessionResponse>

    AbstractExecutable
        BaseComponent
        AbstractComponent
    ExecutableRequest
        RequestComponent
        AbstractExecutable
    ExecutableResponse
        ResponseComponent
        AbstractExecutable

    AbstractComputeResource
        BaseComponent
        AbstractComponent
    ComputeResourceRequest
        RequestComponent
        AbstractComputeResource
    ComputeResourceResponse
        ResponseComponent
        AbstractComputeResource

    AbstractDataResource
        BaseComponent
        AbstractComponent
    DataResourceRequest
        RequestComponent
        AbstractDataResource
    DataResourceResponse
        ResponseComponent
        AbstractDataResource

    AbstractStorageResource
        BaseComponent
        AbstractComponent
    StorageResourceRequest
        RequestComponent
        AbstractStorageResource
    StorageResourceResponse
        ResponseComponent
        AbstractStorageResource

    AbstractVolumeMount
        BaseComponent
        AbstractComponent
    VolumeMountRequest
        RequestComponent
        AbstractVolumeMount
    VolumeMountResponse
        ResponseComponent
        AbstractVolumeMount



